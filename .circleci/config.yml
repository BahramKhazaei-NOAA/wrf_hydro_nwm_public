version: 2
jobs:
  build:
    docker:
      - image: wrfhydro/ci:sixmile     
#        auth:
#          username: $DOCKER_USERNAME  
#          password: $DOCKER_PASSWORD
    working_directory: /wrf_hydro_ci
    steps:
      - run:
          name: Clone testing repo
          command: git clone https://${GITHUB_USERNAME}:${GITHUB_AUTHTOKEN}@github.com/NCAR/wrf_hydro_tests /wrf_hydro_ci/wrf_hydro_tests
      - run:
          name: Configure environment
          command: cd /wrf_hydro_ci/wrf_hydro_tests/CI; source bash_env_setup.sh; cd -
      - checkout:
          path: /wrf_hydro_ci/repos/candidate
      - run:
          name: Compile ?
          command: bash /wrf_hydro_ci/wrf_hydro_tests/questions/compile.sh
      - run:
          name: Run ?
          command: bash /wrf_hydro_ci/wrf_hydro_tests/questions/run.sh
      - run:
          name: Restart ?
          command: bash /wrf_hydro_ci/wrf_hydro_tests/questions/perfect_restart.sh
      - run:
          name: Number of cores ?
          command: bash /wrf_hydro_ci/wrf_hydro_tests/questions/number_of_cores.sh
      - run:
          name: Regression ?
          command: bash /wrf_hydro_ci/wrf_hydro_tests/questions/regression.sh
